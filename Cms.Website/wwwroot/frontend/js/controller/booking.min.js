var BookingController=function(){function d(){var r=new Date,a=r.getMonth()+"/"+r.getDate()+"/"+r.getFullYear();$("#datePick").datepicker({language:"en",minDate:new Date,dateFormat:"mm/dd/yyyy",onSelect:function(n,t){t&&k(t,30)}});$("#datePick").datepicker().data("datepicker").selectDate(new Date);$("#phonenumber").mask("999-999-9999");$.validator.addMethod("customemail",function(n){if(n!=null&&n.length>0)return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(n).toLowerCase());return!0},"Sorry, I've enabled very strict email validation");$.validator.addMethod("noSpace",function(n){return n.trim().length==0},"No space please and don't leave it empty");$("#frmbooking").validate({errorClass:"has-error",errorPlacement:function(n,t){t.parents(".col").append(n)},rules:{Name:{required:!0},PhoneNumber:{required:!0},Email:{customemail:!0},Note:{}},messages:{Name:{required:"Enter Name"},PhoneNumber:{required:"Enter the Phone Nubmer"},Email:{required:"Enter the Email"}},submitHandler:function(){}});$("#booking-step ul li a, #services-tab-back, #services-tab-next, #time-tab-next, #time-tab-back, #finish-tab-next").on("click",function(e){var a,v,d,g,y;if(isFinish&&(currentTab="start-tab",currentForm="pills-start",s(),carTotal=0,$("#cartTotal").html("$"+carTotal),u={services:"",datePick:r.getMonth()+"/"+r.getDate()+"/"+r.getFullYear()+" 10:10",timePick:Date,cusInfo:{}},f={},o={parentId:"",childs:[]},i=[],t=[],n=[],h(),c(),w(),b(),p(),$("#frmbooking").clearForm(),$("#yourname").focus(),isFinish=!1,isReset=!0,$("#bookingParentService input[type=checkbox]:first").trigger("click")),a=$(this).attr("id"),($(this).parent(".next")&&$(this).parent(".next").length>0||$(this).parent(".prev")&&$(this).parent(".prev").length>0)&&(a=$(this).data("step")),a!="start-tab"){if($("#steponeSubmit").trigger("submit"),$("#frmbooking").valid()){if(currentTab=a,v={},$.each($("#frmbooking").serializeArray(),function(n,t){v[t.name]=v[t.name]?v[t.name]||t.value:t.value}),f=v,$("#pills-start").removeClass("active show"),$("#pills-services").addClass("active show"),a!="services-tab"){if(!n||n&&n.length<=0)return $("#errServiceStep").html("Please Pick Services"),currentTab="services-tab",e.preventDefault(),!1;$("#errServiceStep").html("");isReset=!1}else isReset&&$("#bookingParentService input[type=checkbox]:first").trigger("click");s()}}else currentTab="start-tab",s();if(k(new Date,30),a=="time-tab")if(timePickSuggest==""){l($("#lstTimePick li:first"));d="9:30 AM";(new Date).getDay()==0&&(d="11:00 AM");g=$("#datePick").val()+" "+d;u.timePick=new Date;let n=new Date(g);u.datePick=n.toLocaleString()}else y=$("#lstTimePick li").find('input[data-val="'+timePickSuggest+'"]'),y&&y.length>0&&l(y.closest("li"))});$("#slider-product .item").click(function(){$("#slider-product .item h3").removeClass("h3-service-select");$(this).find("h3").addClass("h3-service-select");$("#slider-product .item").find("h3 i").attr("hidden",!0);$(this).find("input[type=checkbox]").prop("checked",!0);$(this).find("h3 i").first().removeAttr("hidden");var t=$(this).find("input[type=checkbox]").prop("checked"),n=$(this).find("input[type=checkbox]").data("id");t==!0&&n?(v(n),$(this).find("input[type=checkbox]").prop("checked",!0)):v(n,!1)});$("#time-tab-next, #finish-tab").click(function(t){if(!n||n&&n.length<=0)return t.preventDefault(),!1;currentTab="finish-tab";s();cardFinishTotal=carTotal;$("#finishTotal").html("$"+cardFinishTotal);w();b()});$("#btnBooking").click(function(){if(!n||n&&n.length<=0)return e.preventDefault(),!1;u.services=n;u.cusInfo=f;$.ajax({type:"POST",url:"/Booking/add",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(u),beforeSend:function(){helper.startLoading()},success:function(){isFinish=!0;helper.stopLoading();$("#modalFinish").modal("show")},failure:function(){helper.stopLoading();$("#modalFinishError").modal("show")},error:function(){helper.stopLoading();$("#modalFinishError").modal("show")},complete:function(){helper.stopLoading()}})});$("#slider-product").owlCarousel({items:4,itemsDesktop:[1e3,1],itemsDesktopSmall:[900,1],itemsTablet:[600,1],itemsMobile:!1,navigation:!0,pagination:!1,autoPlay:!1,slideSpeed:1e3,paginationSpeed:1e3,navigationText:['<i class="fa fa-angle-left" aria-hidden="true"><\/i>','<i class="fa fa-angle-right" aria-hidden="true"><\/i>']})}function s(){var n=$("#booking-step ul li a");n.each(function(n,t){$(t).closest("li").removeClass("active");$(t).removeClass("active show")});$("#"+currentTab).closest("li").addClass("active");$("#"+currentTab).addClass("active show");$('[id^="pills-"]').removeClass("active show");$("#pills-"+currentTab.split("-")[0]).addClass("active show")}function v(n,r=true){r?$.ajax({type:"get",data:this.loadChildServices,url:"/service/GetByID?id="+n,dataType:"json",success:function(r){console.log(r);var u=r;o=Object.assign({},o);i=[];o.parentId=n;o.childs=Object.assign({},u);i.push(o);t=[];$.each(i,function(n,i){$.each(i.childs,function(n,i){t.push(i)})});c()},error:function(n){console.log(n)}}):i.find(t=>t.parentId==n)&&(i=i.filter(t=>t.parentId!=n),t=[],$.each(i,function(n,i){$.each(i.childs,function(n,i){t.push(i)})}),c())}function g(i,r=true){if(r){if(!n.find(n=>n.id==i)){let r=t.find(n=>n.id==i);r&&n.push(r)}}else n=n.filter(n=>n.parentId!=i);y();h()}function y(){carTotal=n.reduce(function(n,t){return n+parseInt(t.salePrice)},0);timeServiceTotal=n.reduce(function(n,t){return n+parseInt(t.time||0)},0);$("#cartTotal").html("$"+carTotal)}function c(){var f=$("#table-template").html(),u="";$.each(i,function(n,t){lst=t.childs;$.each(lst,function(n,t){u+=Mustache.render(f,{Id:t.id,Name:t.name,SalePrice:t.salePrice,Time:t.time==""||t.time=="null"||t.time==null?"":t.time+"'",Image:t.imageName!=null?t.imageName:"/images/ourservice/01.jpg"})})});(u!=""||u==""&&i.length==0)&&($("#tbl-content").html(u),$("#tbl-content tr td div div").click(function(){var f=$(this),i=$(f).closest("tr").find("input[type=checkbox]").data("id"),u;r=i;u=t.find(n=>n.id==i);u&&$.ajax({type:"get",data:this.loadChildServices,url:"/service/GetLisEmployee?id="+i,dataType:"json",success:function(r){var f=r,e,o,s,u;f&&f.length>0&&(a=f,p(),e=t.find(n=>n.id==i),o=n.find(n=>n.id==i),e&&o?(s=e.techID,u=$("#lst-emp .item").find('input[data-id="'+s+'"]'),u&&($("#lst-emp .item h3").removeClass("h3-service-select"),$(u).closest(".item").find("h3").addClass("h3-service-select"),$("#lst-emp .item").find("h3 i").attr("hidden",!0),$(u).closest(".item").find("h3 i").first().removeAttr("hidden"),$(u).closest(".item").find("input[type=radio]").prop("checked",!0))):($("#lst-emp .item h3").removeClass("h3-service-select"),$("#lst-emp .item").find("h3 i").attr("hidden",!0)),$("#modalEmployees").modal("show"))},error:function(){}})}))}function h(){var r=$("#table-template-card").html(),i="";if($.each(n,function(n,t){i+=Mustache.render(r,{Id:t.id,Name:t.name,Time:t.time,SalePrice:t.salePrice,Image:t.imageName!=null?t.imageName:"/images/ourservice/01.jpg",TechID:t.techID,TechName:t.techName})}),i!=""||i==""&&n.length==0){$("#tbl-content-card").html(i);$("#tbl-content-card tr td a").on("click",function(){var i=$(this).data("id"),r,u;n.find(n=>n.id==i)&&(n=n.filter(n=>n.id!=i),y(),r=$("#tbl-content tr td div input[data-id="+i+"]"),$(r).prop("checked",!1),h(),$(r).closest("div").removeClass("h3-service-select"),$(r).closest("div").find("i").attr("hidden",!0),t.find(n=>n.id==i)&&(u=t.findIndex(n=>n.id==i),t[u].techID=null,t[u].techName=null))})}}function p(){var u=$("#table-template-lst-emp").html(),i="";if($.each(a,function(n,t){i+=Mustache.render(u,{Name:t.name,Id:t.employeeID,Avartar:"/images/ourservice/01.jpg"})}),i!=""){$("#lst-emp").html(i);$("#lst-emp .item").on("click",function(){var i;$("#lst-emp .item h3").removeClass("h3-service-select");$(this).find("h3").addClass("h3-service-select");$("#lst-emp .item").find("h3 i").attr("hidden",!0);$(this).find("h3 i").first().removeAttr("hidden");$(this).find("input[type=radio]").prop("checked",!0);var u=$(this).find("input[type=radio]:checked"),f=$(u).data("id"),e=$(u).data("name"),o=r;t.find(n=>n.id==r)&&(i=t.findIndex(n=>n.id==r),t[i].techID=f,t[i].techName=e);r&&(g(r),serviceElement=$("#tbl-content tr td div input[data-id="+r+"]"),$(serviceElement).closest("div").addClass("h3-service-select"),$(serviceElement).closest("div").find("i").removeAttr("hidden"));n&&n.find(n=>n.id==r)&&(i=n.findIndex(n=>n.id==r),n[i].techID=f,n[i].techName=e,h());$("#modalEmployees").modal("hide")})}}function w(){var o=$("#table-template-finish").html(),r="",s=$("#datePick").val()+" "+timePickSuggest;let n=new Date(s);u.datePick=n.toLocaleString();var e=new Date(u.datePick),t=timeServiceTotal==""||timeServiceTotal==0||timeServiceTotal==null?e:new Date(e.setMinutes(e.getMinutes()+timeServiceTotal)),i=new Date;r+=Mustache.render(o,{CusName:f.Name,CusPhone:f.PhoneNumber,CusEmail:f.Email,CusMessage:f.Note,TimePick:timePickSuggest!=""?n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear()+", "+n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear(),BookTime:i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear()+", "+i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),ESTFinishTime:timePickSuggest!=""?t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()+", "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()});r!=""&&$("#tb-finihs-content-header").html(r)}function b(){var i=$("#table-template-finish-body").html(),t="";$.each(n,function(n,r){t+=Mustache.render(i,{Id:r.id,ServiceName:r.name,ServicePrice:r.salePrice,ServiceImage:r.imageName!=null?r.imageName:"~/images/ourservice/01.jpg",ServiceTechImage:"~/images/ourservice/01.jpg",ServiceTech:r.time==null||r.time==""?"":r.time+"'",ServiceTechName:r.techName})});t!=""&&$("#tb-finihs-content-body").html(t)}function k(n,t){var s=helper.isToday(n),u,o,r;arrTime=[];var f=s?new Date:new Date(n),e=f.getHours(),i=new Date(1970,0,1,9,0,0,0);if(i.setMinutes(i.getMinutes()+t),e>9&&(i=new Date(1970,0,1,e,0,0,0)),f.getDay()!=0)while(i.getHours()<=19)u=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),i.setMinutes(i.getMinutes()+t),arrTime.push(u);else{for(f.getDay()==0&&(i=new Date(1970,0,1,11,0,0,0));i.getHours()<=17;)u=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),i.setMinutes(i.getMinutes()+t),arrTime.push(u);arrTime.splice(-1,1)}o=$("#table-time-template").html();r="";$.each(arrTime,function(n,t){r+=Mustache.render(o,{Time:t})});(r!=""||r==""&&arrTime.length==0)&&$("#lstTimePick").html(r);$("#lstTimePick li").click(function(){l($(this))})}function l(n){if(n&&n.length>0){$("#lstTimePick li").removeClass("select");n.addClass("select");$("#lstTimePick li span i").attr("hidden",!0);n.find("i").first().removeAttr("hidden");var t=n.find("input"),r=t.prop("checked"),i=t.data("val");timePickSuggest=i}}isFinish=!1;isReset=!0;currentTab="start-tab";$("#"+currentTab).closest("li").addClass("active");$("#"+currentTab).addClass("active show");currentForm="pills-start";carTotal=0;cardFinishTotal=0;eSTFinishTime=0;timeServiceTotal=0;timePickSuggest="";$("#cartTotal").html("$"+carTotal);$("#finishTotal").html("$"+cardFinishTotal);var u={services:"",datePick:Date,timePick:Date,cusInfo:{}},f={},o={parentId:"",childs:[]},r="",i=[],t=[],n=[],a=[];s();this.initialize=function(){d()};$.fn.clearForm=function(){return this.each(function(){var n=this.type,t=this.tagName.toLowerCase();if(t=="form")return $(":input",this).clearForm();n=="text"||n=="password"||t=="textarea"?this.value="":n=="checkbox"||n=="radio"?this.checked=!1:t=="select"&&(this.selectedIndex=-1)})}},initForm=function(){function n(){}this.initialize=function(){n()}};